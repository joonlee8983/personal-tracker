generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enums
enum ItemType {
  todo
  reminder
  idea
  note
}

enum ItemStatus {
  active
  done
  archived
}

enum Priority {
  P0
  P1
  P2
}

enum SourceType {
  text
  voice
  telegram
}

// Items - main tasks/notes/reminders
model Item {
  id              String     @id @default(cuid())
  userId          String     // Supabase auth.users UUID
  type            ItemType
  title           String
  details         String?    @db.Text
  status          ItemStatus @default(active)
  dueAt           DateTime?
  priority        Priority?
  tags            String[]   @default([])
  sourceType      SourceType
  sourceText      String     @db.Text
  sourceAudioUrl  String?
  needsReview     Boolean    @default(false)
  agentConfidence Float?
  agentRawJson    Json?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@index([userId, status])
  @@index([userId, type])
  @@index([userId, dueAt])
  @@index([userId, needsReview])
  @@map("Item")
}

// User Settings
model UserSettings {
  id                 String    @id @default(cuid())
  userId             String    @unique // Supabase auth.users UUID
  dailyDigestEnabled Boolean   @default(true)
  dailyDigestTime    String    @default("08:00")
  timezone           String    @default("America/Los_Angeles")
  lastDigestSentAt   DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@map("UserSettings")
}

// Push notification tokens
model DevicePushToken {
  id            String   @id @default(cuid())
  userId        String   // Supabase auth.users UUID
  expoPushToken String   @unique
  platform      String
  deviceName    String?
  deviceId      String?
  isEnabled     Boolean  @default(true)
  lastSeenAt    DateTime @default(now())
  createdAt     DateTime @default(now())

  @@index([userId])
  @@index([isEnabled])
  @@map("DevicePushToken")
}

// Digest logs
model DigestLog {
  id            String   @id @default(cuid())
  userId        String   // Supabase auth.users UUID
  date          DateTime @db.Date
  sentAt        DateTime?
  sentVia       String?
  pushSentAt    DateTime?
  content       String   @db.Text
  itemsIncluded String[] @default([])
  createdAt     DateTime @default(now())

  @@unique([userId, date])
  @@index([userId, date])
  @@map("DigestLog")
}
